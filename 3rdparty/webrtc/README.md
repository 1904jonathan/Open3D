# Use WebRTC with Open3D

You have two ways to enable WebRTC in Open3D.
- Method 1: Set `-DBUILD_WEBRTC_FROM_SOURCE=OFF` and Open3D will fetch and use
  a pre-compiled WebRTC package.
  - Method 1 Prepare-Phase: The pre-compiled WebRTC package is prepared by the Open3D dev team.
  - Method 1 Consume-Phase: The pre-compiled WebRTC package is consumed by the Open3D build system.
- Method 2: Set `-DBUILD_WEBRTC_FROM_SOURCE=ON` and this webrtc_build.cmake
  will be used. This is only recommended for advanced users.

Files:
```
0001-xxx.patch x3     # Git patch for -DBUILD_WEBRTC_FROM_SOURCE=ON                                (Method 1 Prepare-Phase & Method 2)
CMakeLists.txt        # Used by `webrtc_build.sh` to generate pre-compiled WebRTC package          (Method 1 Prepare-Phase)
Dockerfile.webrtc     # Run this to call `webrtc_build.sh` to generate pre-compiled WebRTC package (Method 1 Prepare-Phase)
webrtc_build.cmake    # Used by Open3D build system. Build and consume WebRTC alongside Open3D.    (Method 2)
webrtc_build.sh       # Used by `Dockerfile.webrtc`.                                               (Method 1 Prepare-Phase)
webrtc_common.cmake   # Specifies Common WebRTC targets.                                           (Method 1 Prepare-Phase)
webrtc_download.cmake # Used by the Open3D build system. Consume WebRTC pre-compiled package.      (Method 1 Consume-Phase)
```

## Method 1

The pre-compiled WebRTC package used in Method 1 is generated by
`.github/workflows/Dockerfile.webrtc`. You can build your own pre-compiled
WebRTC package by building this docker container.

## Method 2

1. Download depot_tools, webrtc to following directories:
   ```
   ├── Oepn3D
   ├── depot_tools
   └── webrtc
       ├── .gclient
       └── src
   ```
   Example commands:
   ```bash
   # You're in Open3D
   cd ..
   git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
   export PATH=$PATH:`realpath depot_tools`
   mkdir webrtc
   cd webrtc
   fetch --no-history webrtc
   cd ../Open3D
   ```
   You may also want to checkout a specific commit for `depot_tools` and webrtc.
   See `Dockerfile.webrtc` and `webrtc_build.sh::download_webrtc_sources()` on
   how to do that.
2. `depot_tools` and `webrtc` need to be compatible, see:
   https://chromium.googlesource.com/chromium/src/+/master/docs/building_old_revisions.md
3. Apply the following patch to enable GLIBCXX_USE_CXX11_ABI selection:
   ```
   0001-build-enable-rtc_use_cxx11_abi-option.patch       # apply to webrtc/src
   0001-src-enable-rtc_use_cxx11_abi-option.patch         # apply to webrtc/src/build
   0001-third_party-enable-rtc_use_cxx11_abi-option.patch # apply to webrtc/src/third_party
   ```
   Note that these patches may or may not be compatible with your custom
   WebRTC commits. You may have to patch them manually.
