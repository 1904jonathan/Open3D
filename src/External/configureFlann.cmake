SET(LIB_NAME         "Flann")
SET(MIN_VERSION      "1.8.4")
SET(DOWNLOAD_VERSION "1.9.1")
SET(DOWNLOAD_TYPE    "URL")
SET(DOWNLOAD_URL     "https://github.com/mariusmuja/flann/archive/${DOWNLOAD_VERSION}.tar.gz")
SET(BASE_DIR         "${CMAKE_BINARY_DIR}/${LIB_NAME}")
SET(DOWNLOADER_DIR   "${BASE_DIR}-download")
SET(BUILD_SOURCE     ON)
SET(BUILD_OPTIONS    -DBUILD_CUDA_LIB:BOOL=OFF -DBUILD_C_BINDINGS:BOOL=OFF -DBUILD_MATLAB_BINDINGS:BOOL=OFF -DBUILD_PYTHON_BINDINGS:BOOL=OFF -DBUILD_DOCS:BOOL=OFF)
SET(BUILD_TARGET     "flann_cpp_s")

include(configure.cmake)

IF (NOT ${${LIB_NAME_UPPER}_FOUND})

    FILE(GLOB _LIBS "${LIB_DIR}/*")
    list(FILTER _LIBS INCLUDE REGEX "${BUILD_TARGET}*")
    SET(${LIB_NAME_UPPER}_INCLUDE_DIR ${INCLUDE_DIR} CACHE PATH "The path to ${LIB_NAME} headers" FORCE)
    MESSAGE(STATUS "${LIB_NAME_UPPER}_INCLUDE_DIR: ${${LIB_NAME_UPPER}_INCLUDE_DIR}")
    SET(${LIB_NAME_UPPER}_CPP_LIBRARY_STATIC ${_LIBS} CACHE FILE "The ${LIB_NAME} library" FORCE)
    MESSAGE(STATUS "${LIB_NAME_UPPER}_CPP_LIBRARY_STATIC: ${${LIB_NAME_UPPER}_CPP_LIBRARY_STATIC}")

ENDIF()

IF (Open3D_INSTALL_EXTERNALS)
    install(DIRECTORY ${${LIB_NAME_UPPER}_INCLUDE_DIR}/flann
        DESTINATION include COMPONENT Devel)
    install(FILES ${${LIB_NAME_UPPER}_CPP_LIBRARY_STATIC}
        DESTINATION lib COMPONENT Devel)
ENDIF()
